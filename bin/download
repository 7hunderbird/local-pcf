#!/bin/bash

set -eu

# Set your authentication token from Pivotal Network

export UAA_API_TOKEN=REPLACE_ME
export PRODUCT=pcfdev

login () {
    pivnet login --api-token=${UAA_API_TOKEN}
}

download () {
  pivnet download-product-files --accept-eula --product-slug $PRODUCT_SLUG \
  --release-version "${RELEASE_VERSION}" --glob=* --download-dir=./iso
}

# login to the pivotal network
login

export    PRODUCT_SLUG=$(pivnet --format=json product -p ${PRODUCT} \
                                | jq -r .slug)
export RELEASE_VERSION=$(pivnet --format=json releases -p ${PRODUCT} \
                                | jq -r .[0].version)

# download the image
download
